<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="jrl">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2023/11/23/vehicle-project/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="Vehicle ProjectAuthor: jrl777   基于STM32F103C8T6的两轮自平衡小车的学习过程记录，与诸君分享。内容参考平衡车开发指南。 1.原理分析1.1 平衡原理  控制平衡小车的基本原理是控制中的负反馈机制。   由于小车只有两个轮子着地，车体只会在轮子滚动的方向上发生倾斜。控制轮子转动，抵消在一个维度上倾斜的趋势便可以保持车体平衡了。   接下来需要解决的问题就转">
<meta property="og:type" content="article">
<meta property="og:title" content="MCU-Vehicle-Project">
<meta property="og:url" content="http://example.com/2023/11/23/Vehicle-Project/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Vehicle ProjectAuthor: jrl777   基于STM32F103C8T6的两轮自平衡小车的学习过程记录，与诸君分享。内容参考平衡车开发指南。 1.原理分析1.1 平衡原理  控制平衡小车的基本原理是控制中的负反馈机制。   由于小车只有两个轮子着地，车体只会在轮子滚动的方向上发生倾斜。控制轮子转动，抵消在一个维度上倾斜的趋势便可以保持车体平衡了。   接下来需要解决的问题就转">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2023/11/23/Vehicle-Project/image-20231217154208876.png">
<meta property="og:image" content="http://example.com/2023/11/23/Vehicle-Project/image-20231217165019714.png">
<meta property="og:image" content="http://example.com/2023/11/23/Vehicle-Project/image-20231225001059945.png">
<meta property="og:image" content="http://example.com/2023/11/23/Vehicle-Project/image-20231225003040396.png">
<meta property="og:image" content="http://example.com/2023/11/23/Vehicle-Project/image-20231225003541488.png">
<meta property="og:image" content="http://example.com/2023/11/23/Vehicle-Project/image-20231225003606173.png">
<meta property="og:image" content="http://example.com/2023/11/23/Vehicle-Project/image-20231225003644774.png">
<meta property="og:image" content="http://example.com/2023/11/23/Vehicle-Project/image-20231225004034334.png">
<meta property="og:image" content="http://example.com/2023/11/23/Vehicle-Project/image-20231225004240597.png">
<meta property="og:image" content="http://example.com/2023/11/23/Vehicle-Project/image-20231225004706970.png">
<meta property="og:image" content="http://example.com/2023/11/23/Vehicle-Project/image-20231225005115476.png">
<meta property="og:image" content="http://example.com/2023/11/23/Vehicle-Project/image-20231225005153894.png">
<meta property="og:image" content="http://example.com/2023/11/23/Vehicle-Project/image-20231225005541920.png">
<meta property="og:image" content="http://example.com/2023/11/23/Vehicle-Project/image-20240103235126547.png">
<meta property="og:image" content="http://example.com/2023/11/23/Vehicle-Project/image-20240103235306412.png">
<meta property="og:image" content="http://example.com/2023/11/23/Vehicle-Project/image-20231229163953002.png">
<meta property="og:image" content="http://example.com/2023/11/23/Vehicle-Project/image-20231229164303421.png">
<meta property="og:image" content="http://example.com/2023/11/23/Vehicle-Project/image-20240102175836402.png">
<meta property="article:published_time" content="2023-11-23T15:32:52.000Z">
<meta property="article:modified_time" content="2024-01-04T11:03:44.224Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="MCU">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2023/11/23/Vehicle-Project/image-20231217154208876.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/d51b6e276e6c429db8275af5916f6f1d!400x400.jpeg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/d51b6e276e6c429db8275af5916f6f1d!400x400.jpeg">
    <meta name="theme-color" content="#005080">
    <link rel="shortcut icon" href="/images/d51b6e276e6c429db8275af5916f6f1d!400x400.jpeg">
    <!--- Page Info-->
    
    <title>
        
            MCU-Vehicle-Project -
        
        H&#39;s Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/fonts/fonts.css">

    
<link rel="stylesheet" href="/fonts/Satoshi/satoshi.css">

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">

    <!--- Font Part-->
    
    
    
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    let Global = window.Global || {};
    Global.hexo_config = {"hostname":"example.com","root":"/","language":"en","path":"search.json"};
    Global.theme_config = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":true,"list":["Lv1","Lv2","Lv3","Lv4","Lv5","Lv6"]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":true,"lazyload":true,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#005080","secondary":null},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":true},"scroll_progress":{"bar":false,"percentage":true},"busuanzi_counter":{"enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"pjax":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/r.png","dark":"/images/l.png"},"title":"JRL777","subtitle":{"text":["You the freedom"],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#660000","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"links":{"github":"https://github.com/jrl777","instagram":null,"zhihu":null,"twitter":null,"email":"18994771096@163.com"}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.2.2","navbar":{"auto_hide":true,"color":{"left":"#f78736","right":"#367df7","transparency":35},"categories":{"Categories":{"icon":"fa-solid fa-folder","path":"/categories/"}},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-bars"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"Me":{"path":"/about","icon":"fa-regular fa-user"}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"links":null},"article_date_format":"auto","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2022/8/17 11:45:14"};
    Global.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    Global.data_config = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 6.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="main-content-container">

        <div class="main-content-header">
            <header class="navbar-container">
    
    <div class="navbar-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                H&#39;s Blog
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        HOME
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/archives"  >
                                    
                                        
                                            <i class="fa-regular fa-bars"></i>
                                        
                                        ARCHIVES
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/tags"  >
                                    
                                        
                                            <i class="fa-regular fa-tags"></i>
                                        
                                        TAGS
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/about"  >
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        ME
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer">
        <ul class="drawer-navbar-list">
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                HOME
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/archives"  >
                             
                                
                                    <i class="fa-regular fa-bars"></i>
                                
                                ARCHIVES
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/tags"  >
                             
                                
                                    <i class="fa-regular fa-tags"></i>
                                
                                TAGS
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/about"  >
                             
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                ME
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            <div class="article-title">
                
                  
                  
                    <img src="/images/wallhaven-0wxgp4.jpg" alt="MCU-Vehicle-Project" />
                  
                  <h1 class="article-title-cover">MCU-Vehicle-Project</h1>
                
              </div>
              
                     
            
            
                <div class="article-header">
                    <div class="avatar">
                        <img src="/images/d51b6e276e6c429db8275af5916f6f1d!400x400.jpeg">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">jrl</span>
                            
                                <span class="author-label">Lv2</span>
                            
                        </div>
                        <div class="meta-info">
                            <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2023-11-23 23:32:52</span>
        <span class="mobile">2023-11-23 23:32:52</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2024-01-04 19:03:44</span>
            <span class="mobile">2024-01-04 19:03:44</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/MCU/">MCU</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/MCU/">MCU</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>3.7k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>13 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content markdown-body">
                <h1 id="Vehicle-Project"><a href="#Vehicle-Project" class="headerlink" title="Vehicle Project"></a>Vehicle Project</h1><p>Author: jrl777</p>
<p>  基于STM32F103C8T6的两轮自平衡小车的学习过程记录，与诸君分享。内容参考平衡车开发指南。</p>
<h1 id="1-原理分析"><a href="#1-原理分析" class="headerlink" title="1.原理分析"></a>1.原理分析</h1><h2 id="1-1-平衡原理"><a href="#1-1-平衡原理" class="headerlink" title="1.1 平衡原理"></a>1.1 平衡原理</h2><p>  控制平衡小车的基本原理是控制中的<strong>负反馈机制</strong>。</p>
<p>  由于小车只有两个轮子着地，车体只会在轮子滚动的方向上发生倾斜。控制轮子转动，抵消在一个维度上倾斜的趋势便可以保持车体平衡了。</p>
<img lazyload="" src="/images/loading.svg" data-src="/2023/11/23/Vehicle-Project/image-20231217154208876.png" class="" title="image-20231217154208876">

<p>接下来需要解决的问题就转化成如何控制小车车轮的运动，以此控制小车的平衡了。需要建立两轮自平衡小车的<strong>运动学</strong>和<strong>动力学</strong>数学模型，设计反馈控制来保证车体的平衡。</p>
<h2 id="1-2-动力学分析"><a href="#1-2-动力学分析" class="headerlink" title="1.2 动力学分析"></a>1.2 动力学分析</h2><p>  保持车体平衡的控制规律可以简化为理想化的<strong>单摆</strong>物理模型。</p>
<img lazyload="" src="/images/loading.svg" data-src="/2023/11/23/Vehicle-Project/image-20231217165019714.png" class="" title="image-20231217165019714">

<p>  对单摆模型进行受力分析。</p>
<p>  我们都知道，在单摆偏离平衡位置时会受到<strong>重力</strong>、和<strong>阻尼力</strong>的作用。而<strong>回复力</strong>是重力在切向上的分力（单摆在切向上作间简谐运动），属于作用力。</p>
<p>  当物体离开平衡位置后，会受到重力和绳子的合力的作用，使物体回到平衡位置。这个合力就称为：<strong>回复力</strong>。其大小为</p>
<p>​                                                                                <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="22.702ex" height="2.059ex" role="img" focusable="false" viewBox="0 -705 10034.1 910"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(1026.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mo" transform="translate(2082.6,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(2860.6,0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(3738.6,0)"><path data-c="1D454" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path></g><g data-mml-node="mi" transform="translate(4215.6,0)"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(4684.6,0)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(5029.6,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(5629.6,0)"><path data-c="1D703" d="M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z"></path></g><g data-mml-node="mo" transform="translate(6376.3,0)"><path data-c="2248" d="M55 319Q55 360 72 393T114 444T163 472T205 482Q207 482 213 482T223 483Q262 483 296 468T393 413L443 381Q502 346 553 346Q609 346 649 375T694 454Q694 465 698 474T708 483Q722 483 722 452Q722 386 675 338T555 289Q514 289 468 310T388 357T308 404T224 426Q164 426 125 393T83 318Q81 289 69 289Q55 289 55 319ZM55 85Q55 126 72 159T114 210T163 238T205 248Q207 248 213 248T223 249Q262 249 296 234T393 179L443 147Q502 112 553 112Q609 112 649 141T694 220Q694 249 708 249T722 217Q722 153 675 104T555 55Q514 55 468 76T388 123T308 170T224 192Q164 192 125 159T83 84Q80 55 69 55Q55 55 55 85Z"></path></g><g data-mml-node="mo" transform="translate(7432.1,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(8210.1,0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(9088.1,0)"><path data-c="1D454" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path></g><g data-mml-node="mi" transform="translate(9565.1,0)"><path data-c="1D703" d="M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z"></path></g></g></g></svg></mjx-container></p>
<p>  在偏移角度很小的情况下，回复力与偏移的角度之间大小成正比，方向相反。 在此回复力作用下，单摆便进行周期运动。在空气中运动的单摆，由于受到空气的阻尼力， 单摆最终会停止在垂直平衡位置。空气的阻尼力与单摆运动速度成正比，方向相反。阻尼力越大，单摆越会尽快在垂直位置稳定下来。</p>
<p>  在不同阻尼系数下，单摆的运动曲线也不同。</p>
<img lazyload="" src="/images/loading.svg" data-src="/2023/11/23/Vehicle-Project/image-20231225001059945.png" class="" title="image-20231225001059945">



<p>  我们都知道，对于单摆而言，稳定在垂直位置（平衡位置）的条件有两个：</p>
<ol>
<li>受到与位移（角度）相反的恢复力；</li>
<li>受到与运动速度（角速度）相反的阻尼力。</li>
</ol>
<p>  如果没有阻尼力，单摆会在垂直位置左右摆动。阻尼力会使得单摆最终停止在垂直位置。阻尼力过小（欠阻尼）会使得单摆在平衡位置附件来回震荡。阻尼力过大（过阻尼）会使得单摆到达平衡位置时间加长，比如气球单摆。因而存在一个临界阻尼系数，使得单摆稳定在平衡位置的时间最短。</p>
<img lazyload="" src="/images/loading.svg" data-src="/2023/11/23/Vehicle-Project/image-20231225003040396.png" class="" title="image-20231225003040396">

<p>  倒立摆之所以不能象单摆一样可以稳定在垂直位置，就是因为在它偏离平衡位置的时候，所受到的回复力与位移方向相同，而不是相反！因此，倒立摆便会加速偏离垂直位置，直到倒下。  所以我们需要给予倒立摆额外的力来使其稳定在批平衡位置。</p>
<h2 id="1-3-数学模型"><a href="#1-3-数学模型" class="headerlink" title="1.3 数学模型"></a>1.3 数学模型</h2><p> 下面对两轮自平衡小车进行简单数学建模，然后建立速度的比例微分负反馈控制，根据基本控制理论讨论小车通过闭环控制保持稳定的条件。</p>
<img lazyload="" src="/images/loading.svg" data-src="/2023/11/23/Vehicle-Project/image-20231225003541488.png" class="" title="image-20231225003541488">

<img lazyload="" src="/images/loading.svg" data-src="/2023/11/23/Vehicle-Project/image-20231225003606173.png" class="" title="image-20231225003606173">

<p>  通过根轨迹示意图，可以很清晰的看出两轮自平衡小车的传递函数对应有两个零极点，有一个在 s 平面的右半平面。这说明两轮自平衡小车是不稳定的。</p>
<p>  小车引入比例、微分（PD）反馈之后的系统如下图所示：</p>
<img lazyload="" src="/images/loading.svg" data-src="/2023/11/23/Vehicle-Project/image-20231225003644774.png" class="" title="image-20231225003644774">









<h2 id="1-4-Simulink仿真"><a href="#1-4-Simulink仿真" class="headerlink" title="1.4 Simulink仿真"></a>1.4 Simulink仿真</h2><p>  通过对两轮自平衡小车系统进行动力学分析和数学建模，在理论上设计出了控制方法。下面，调用 Matlab 软件的 Simulink 仿真工具包对两轮自平衡小车的控制系统数学模型进行仿真验证，观察角度在干扰信号的作用下的自恢复情况。</p>
<p>  在 Simulink 文件中，建立两轮自平衡小车的数学模型，调用 PID 控制器构成控制系统的主要部分。设定输入信号值为 0，代表角度初始值为 0，小车初始在平衡位置。对输出节点，调用两个 Step 模块，通过设定 Step Time，使之构成宽度为 1s 的脉冲信号作为小车的外力干扰作用信号。整体系统构成负反馈形式，如下图所示。</p>
<img lazyload="" src="/images/loading.svg" data-src="/2023/11/23/Vehicle-Project/image-20231225004034334.png" class="" title="image-20231225004034334">









<h2 id="1-5-小车的速度控制原理与串级PID"><a href="#1-5-小车的速度控制原理与串级PID" class="headerlink" title="1.5 小车的速度控制原理与串级PID"></a>1.5 小车的速度控制原理与串级PID</h2><p><strong>PID原理</strong>：<a class="link" target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/39573490">PID控制算法原理（抛弃公式，从本质上真正理解PID控制） - 知乎 (zhihu.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>  通常在三轮小车、四轮小车中，我们使用 PID 进行速度控制，大部分都是负反馈。但是两轮自平衡小车的速度控制不大一样，不是负反馈，而是正反馈，因为小车的两个电机需要进行直立控制的同时去进行速度控制。</p>
<p>  我们先使用常规的速度负反馈算法试一下，看在平衡小车上面是否有效果。首先我们给定一个目标速度值，由于在直立控制的作用下，此时小车要向前倾斜以获取加速度，车轮需要往后运动，这样小车的速度就会下降。因为是负反馈，速度下降之后，速度控制的偏差增大，小车往前倾斜的角度增大，如此反复，小车便会倒下。常规的速度负反馈在直立控制的影响下起到了正反馈效果。如下图所示。</p>
<img lazyload="" src="/images/loading.svg" data-src="/2023/11/23/Vehicle-Project/image-20231225004240597.png" class="" title="image-20231225004240597">

<p>  根据以上的分析，在直立控制里面加入速度负反馈无法达到速度闭环的目的，而且还会破坏直立控制系统。下面我们换一种思路。</p>
<p>  为保证直立控制的优先级，我们把速度控制放在直立控制的前面，也就是速度控制调节的结果仅仅是改变直立控制的目标值。因为根据经验可知，小车的运行速度和小车的倾角是相关的。比如要提高小车向前行驶的速度，就需要增加小车向前倾斜的角度，倾斜角度加大之后，车轮在直立控制的作用下需要向前运动保持小车平衡，速度增大；如果要降低小车向前行驶的速度，就需要减小小车向前的倾斜角度，倾斜角度减小之后，车轮在直立控制的作用下向后运动保持小车平衡，速度减小。如下图所示。</p>
<img lazyload="" src="/images/loading.svg" data-src="/2023/11/23/Vehicle-Project/image-20231225004706970.png" class="" title="image-20231225004706970">

<p>  根据上面的原理图，我们把速度和直立两个控制器串联起来工作，其中速度控制的输出作为直立控制的输入，而直立控制的输出作为系统的输出，这其实就是一个串级控制系统。直立控制在前面有介绍，使用的 PD 控制。因为编码器可能存在的噪声，为防止噪声被放大并消除系统的静差，这里我们速度控制使用 PI 控制。<img lazyload="" src="/images/loading.svg" data-src="/2023/11/23/Vehicle-Project/image-20231225005115476.png" class="" title="image-20231225005115476"></p>
<p>  至此，我们得到了让小车保持直立且速度为给定值的控制算法，由一个负反馈的直立 PD 控制器和一个正反馈的速度 PI 控制器组成。控制原理图进行的演变，如下图所示。<img lazyload="" src="/images/loading.svg" data-src="/2023/11/23/Vehicle-Project/image-20231225005153894.png" class="" title="image-20231225005153894"></p>
<h1 id="2-电路开发"><a href="#2-电路开发" class="headerlink" title="2. 电路开发"></a>2. 电路开发</h1><h2 id="2-1-系统框架一览"><a href="#2-1-系统框架一览" class="headerlink" title="2.1 系统框架一览"></a>2.1 系统框架一览</h2><img lazyload="" src="/images/loading.svg" data-src="/2023/11/23/Vehicle-Project/image-20231225005541920.png" class="" title="image-20231225005541920">

<p>  由上面系统框架图可以看到，整个系统围绕 STM32F103C8T6 主芯片运行，电池经过降压稳压后提供稳定的 5v 和 3.3v 给 STM32 主芯片和各电子模块，STM32 主芯片通过读取 MPU-6050 传感器芯片的数据，获取小车系统的运动状态，再通过 TB6612FNG 驱动芯片控制直流电机的运动，直流电机通过编码器反馈转速给 STM32 主芯片，这就构成了两轮自平衡小车的基本硬件框架。其他的辅助功能，比如蓝牙、OLED、超声波、红外等等都是可加可不加的功能，我们为了提高两轮自平衡小车的可玩性和操纵性，一并加进去。</p>
<h1 id="3-程序框架"><a href="#3-程序框架" class="headerlink" title="3.程序框架"></a>3.程序框架</h1><p>  打开自平衡小车的工程文件，展开的工程分组如下图所示：</p>
<img lazyload="" src="/images/loading.svg" data-src="/2023/11/23/Vehicle-Project/image-20240103235126547.png" class="" title="image-20240103235126547">

<p>如图所示，该工程共有6个具体的分组。</p>
<ol>
<li>FWlib分组：主要是HAL库的文件代码</li>
<li>CMSIS分组：主要是Cortex-M3 核心的文件代码</li>
<li>Startup 分组：stm32f10x 的启动文件代码</li>
<li>BSP 分组：外设硬件的驱动程序代码，例如MPU6050、oled 等等</li>
<li>SYS 分组：主要是滴答定时器和调试相关的配置代码</li>
<li>USER 分组：用户代码，主程序</li>
</ol>
<p><strong>讲解一下 USER 分组的 main.c。main.c 包含了所有硬件初始化和参数初始化代码。初始化代码如下：</strong></p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{        </span><br><span class="line">    BspInit();       <span class="comment">//初始化BSP</span></span><br><span class="line">    PIDInit();       <span class="comment">//初始化PID    </span></span><br><span class="line">    CarUpstandInit();<span class="comment">//初始化系统参数</span></span><br><span class="line">    SysTick_Init();  <span class="comment">//初始化定时器        </span></span><br><span class="line">    <span class="keyword">if</span>(IsInfrareOK())<span class="comment">//检测是否悬挂红外模块</span></span><br><span class="line">        g_iGravity_Offset = <span class="number">1</span>; <span class="comment">//如果检测到悬挂红外模块，则更改偏移值。</span></span><br><span class="line">    ShowHomePageInit();<span class="comment">//初始化OLED显示屏主页</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)<span class="comment">//进入主循环</span></span><br><span class="line">    {    </span><br><span class="line">        SecTask();<span class="comment">//秒级任务，主要是记录小车运行时间、读取电池电压等非实时任务</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(SoftTimer[<span class="number">1</span>] == <span class="number">0</span>)<span class="comment">//系统软件定时器1，分辨率为1ms，递减计数</span></span><br><span class="line">        {<span class="comment">// 每隔20ms 执行一次</span></span><br><span class="line">            SoftTimer[<span class="number">1</span>] = <span class="number">20</span>;</span><br><span class="line">            ResponseIMU();<span class="comment">//上报姿态数据到APP        </span></span><br><span class="line">            DebugService();    <span class="comment">//上位机调试数据发送        </span></span><br><span class="line">            Parse(Uart3Buffer);    <span class="comment">//APP数据解析函数    </span></span><br><span class="line">        }            </span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(SoftTimer[<span class="number">2</span>] == <span class="number">0</span>)<span class="comment">//系统软件定时器2，分辨率为1ms，递减计数</span></span><br><span class="line">        {<span class="comment">// 每隔20ms 执行一次</span></span><br><span class="line">            SoftTimer[<span class="number">2</span>] = <span class="number">20</span>;</span><br><span class="line">            ShowHomePage();<span class="comment">//刷新OLED页面</span></span><br><span class="line">            Read_Distane();<span class="comment">//读取超声波测距距离</span></span><br><span class="line">            <span class="keyword">if</span>(g_CarRunningMode == ULTRA_FOLLOW_MODE){</span><br><span class="line">                <span class="keyword">if</span>(IsUltraOK())UltraControl(<span class="number">0</span>);    <span class="comment">//设置超声波跟随模式</span></span><br><span class="line">             }</span><br><span class="line">            <span class="keyword">if</span>(g_CarRunningMode == ULTRA_AVOID_MODE){</span><br><span class="line">                <span class="keyword">if</span>(IsUltraOK())UltraControl(<span class="number">1</span>);    <span class="comment">//设置超声波避障模式</span></span><br><span class="line">             }</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(g_CarRunningMode == INFRARED_TRACE_MODE){</span><br><span class="line">                TailingControl();<span class="comment">//设置红外循迹模式</span></span><br><span class="line">            }</span><br><span class="line">        }            </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div>

<p>  代码初始化主要是硬件底驱动和系统参数的初始化。</p>
<h2 id="3-1-BspInit-函数"><a href="#3-1-BspInit-函数" class="headerlink" title="3.1 BspInit()函数"></a>3.1 BspInit()函数</h2><p>  <strong>BspInit</strong> 主要是硬件底层驱动的初始化，包括 STM32 外设的初始化、外围模块比如 MPU-6050 的初始化。具体见下面代码：</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">BspInit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    SWDConfig();            <span class="comment">//SWD 调试接口配置，使能 SWD，失能 JTAG</span></span><br><span class="line">    ADCInit();                <span class="comment">//ADC 初始化</span></span><br><span class="line">    USART1Init();            <span class="comment">//串口 1 初始化-底板预留下载及调试用</span></span><br><span class="line">    USART3Init(<span class="number">0</span>);            <span class="comment">//串口 3 初始化-用于蓝牙</span></span><br><span class="line">    TIM1_Cap_Init();        <span class="comment">//TIM1初始化-用于超声波跟随功能</span></span><br><span class="line">    TIM3_PWM_Init();         <span class="comment">//PWM初始化</span></span><br><span class="line">    TIM2_Encoder_Init();    <span class="comment">//TIM2 正交解码初始化-用于测速</span></span><br><span class="line">    TIM4_Encoder_Init();    <span class="comment">//TIM4 正交解码初始化-用于测速    </span></span><br><span class="line">    i2cInit();                 <span class="comment">//I2C 初始化    </span></span><br><span class="line">    InfraredIOInit();        <span class="comment">//红外 IO 口初始化</span></span><br><span class="line">    OLED_Init();            <span class="comment">//OLED 初始化</span></span><br><span class="line">    MPU6050_Init();            <span class="comment">//MPU6050 初始化    </span></span><br><span class="line">    LEDInit();                <span class="comment">//指示灯初始化    </span></span><br><span class="line">    UltraSelfCheck();        <span class="comment">//超声模块开机自检</span></span><br><span class="line">    InfrareSelfCheck();        <span class="comment">//红外模块开机自检    </span></span><br><span class="line">    delay_ms(<span class="number">500</span>);            <span class="comment">//延时 0.5s，等待蓝牙模块启动</span></span><br><span class="line">    Uart3SendStr(<span class="string">"\r\nAT+BAUD8\r\n"</span>); <span class="comment">//配置蓝牙串口波特率为 115200 ( 原波特率9600 ) </span></span><br><span class="line">    USART3Init(<span class="number">1</span>);            <span class="comment">//更改 UART3 波特率为 115200</span></span><br><span class="line">    delay_ms(<span class="number">20</span>);           <span class="comment">//延时 20ms,等待波特率稳定</span></span><br><span class="line">    SetBlueToothName();        <span class="comment">//配置蓝牙模块名称</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>





<h2 id="3-2-PIDInit-函数"><a href="#3-2-PIDInit-函数" class="headerlink" title="3.2 PIDInit 函数"></a>3.2 PIDInit 函数</h2><p>PIDInit 函数主要是对小车系统的PID算法的参数进行初始化。</p>
<p>  PID 是 Proportional（比例）、Integral（积分）、Differential（微分）的首字母缩写；是一种结合比例、积分和微分三种环节于一体的闭环控制算法。PID 控制的实质是对目标值和实际值误差进行比例、积分、微分运算后的结果用来作用在输出上。</p>
<p>  自平衡小车的PID算法思路上文已经讲过，整理就不再赘述了。</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">PIDInit</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">	<span class="type">char</span> flag[<span class="number">2</span>];</span><br><span class="line">	</span><br><span class="line">	ReadFlash(original_PID_Addr, flag, <span class="number">2</span>);</span><br><span class="line">	<span class="keyword">if</span>((flag[<span class="number">0</span>] == <span class="number">0xa5</span>)&amp;&amp;(flag[<span class="number">1</span>] == <span class="number">0x5a</span>))</span><br><span class="line">	{<span class="comment">// 非初次运行</span></span><br><span class="line">		PIDRead();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">else</span>{<span class="comment">// 初次运行</span></span><br><span class="line">		flag[<span class="number">0</span>] = <span class="number">0xa5</span>;</span><br><span class="line">		flag[<span class="number">1</span>] = <span class="number">0x5a</span>;</span><br><span class="line">		ProgramFlash(original_PID_Addr, flag, <span class="number">2</span>);</span><br><span class="line">		ProgramFlash(original_PID_Addr+<span class="number">2</span>, (<span class="type">char</span>*)&amp;g_tCarAnglePID, <span class="keyword">sizeof</span>(PID_t));<span class="comment">// ±£´æ½Ç¶È»·Ä¬ÈÏpid²ÎÊý</span></span><br><span class="line">		ProgramFlash(original_PID_Addr+<span class="number">2</span>+<span class="number">16</span>, (<span class="type">char</span>*)&amp;g_tCarSpeedPID, <span class="keyword">sizeof</span>(PID_t));<span class="comment">// ±£´æËÙ¶È»·Ä¬ÈÏPID²ÎÊý</span></span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div>





<h2 id="3-3-CarUpstandInit函数"><a href="#3-3-CarUpstandInit函数" class="headerlink" title="3.3 CarUpstandInit函数"></a>3.3 CarUpstandInit函数</h2><p>  CarUpstandInit 函数的主要功能是对小车系统的各种参数进行初始化。</p>
<p>  即全局变量初始化函数。</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">CarUpstandInit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">	<span class="comment">//g_iAccelInputVoltage_X_Axis = g_iGyroInputVoltage_Y_Axis = 0;</span></span><br><span class="line">	g_s16LeftMotorPulse = g_s16RightMotorPulse = <span class="number">0</span>;</span><br><span class="line">	g_s32LeftMotorPulseOld = g_s32RightMotorPulseOld = <span class="number">0</span>;</span><br><span class="line">	g_s32LeftMotorPulseSigma = g_s32RightMotorPulseSigma = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	g_fCarSpeed = g_fCarSpeedOld = <span class="number">0</span>;</span><br><span class="line">	g_fCarPosition = <span class="number">0</span>;</span><br><span class="line">	g_fCarAngle    = <span class="number">0</span>;</span><br><span class="line">	g_fGyroAngleSpeed = <span class="number">0</span>;</span><br><span class="line">	g_fGravityAngle   = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	g_fAngleControlOut = g_fSpeedControlOut = g_fBluetoothDirectionOut = <span class="number">0</span>;</span><br><span class="line">	g_fLeftMotorOut    = g_fRightMotorOut   = <span class="number">0</span>;</span><br><span class="line">	g_fBluetoothSpeed  = g_fBluetoothDirection = <span class="number">0</span>;</span><br><span class="line">	g_fBluetoothDirectionNew = g_fBluetoothDirectionOld = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  g_u8MainEventCount=<span class="number">0</span>;</span><br><span class="line">	g_u8SpeedControlCount=<span class="number">0</span>;</span><br><span class="line"> 	g_u8SpeedControlPeriod=<span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>





<h2 id="3-4-SysTick-Init函数"><a href="#3-4-SysTick-Init函数" class="headerlink" title="3.4 SysTick_Init函数"></a>3.4 SysTick_Init函数</h2><p>  SysTick_Init 是系统滴答定时器 SysTick 的初始化，在这里设置为 1ms 中断一次。</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">SysTick_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">	<span class="comment">/* SystemFrequency / 100     10ms中断一次</span></span><br><span class="line"><span class="comment">	   SystemFrequency / 1000    1ms中断一次</span></span><br><span class="line"><span class="comment">	 * SystemFrequency / 100000	 10us中断一次</span></span><br><span class="line"><span class="comment">	 * SystemFrequency / 1000000 1us中断一次</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	SystemCoreClockUpdate();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (SysTick_Config(SystemCoreClock / <span class="number">1000</span>))	<span class="comment">// ST3.5.0库版本</span></span><br><span class="line">	{ </span><br><span class="line">		<span class="comment">/* Capture error */</span> </span><br><span class="line">		<span class="keyword">while</span> (<span class="number">1</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="comment">// 开启滴答定时器 </span></span><br><span class="line">	SysTick-&gt;CTRL |=  SysTick_CTRL_ENABLE_Msk;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div>





<h2 id="3-5-其他函数"><a href="#3-5-其他函数" class="headerlink" title="3.5 其他函数"></a>3.5 其他函数</h2><p>  if(IsInfrareOK()) g_iGravity_Offset = 1; 检测是否悬挂红外循迹模块，如果有则需要修改重心偏移值。因为在一侧悬挂红外后，小车重心会偏移。</p>
<p>  ShowHomePageInit 主要是在 OLED 显示 logo。</p>
<p>  while(1) 主循环中主要是执行一些非实时任务（早些迟些执行都无所谓的任务），人为定义一个秒级任务，轮询执行这些任务。这些非实时任务有上报数据、调试数据、解析协议、刷新 OLED 数据、读取距离等。</p>
<p>  执行完初始化，代码会由于滴答定时器 SysTick 进入中断而转跳到 SysTick 定时中断服务函数中执行。在 stm32f10x_it.c 中可以找到 SysTick_Handler 定时中断服务函数。代码具体内容如下：</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">SysTick_Handler</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{  </span><br><span class="line">    SoftTimerCountDown();             <span class="comment">//软定时器</span></span><br><span class="line">    g_u8MainEventCount++;            <span class="comment">//主事件计数变量</span></span><br><span class="line">    g_u8SpeedControlPeriod++;        <span class="comment">//速度环控制周期计数变量</span></span><br><span class="line">    SpeedControlOutput();            <span class="comment">//速度环控制输出函数，每1ms执行一次</span></span><br><span class="line">    <span class="keyword">if</span>(g_u8MainEventCount&gt;=<span class="number">5</span>)        <span class="comment">//5ms进入一次</span></span><br><span class="line">    {</span><br><span class="line">        g_u8MainEventCount=<span class="number">0</span>;</span><br><span class="line">        GetMotorPulse();             <span class="comment">//捕获电机脉冲（速度）函数，每5ms执行一次</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(g_u8MainEventCount==<span class="number">1</span>)</span><br><span class="line">    {</span><br><span class="line">        MPU6050_Pose();                 <span class="comment">//读取MPU6050数据函数，每5ms执行一次</span></span><br><span class="line">        AngleCalculate();             <span class="comment">//角度环计算函数，每5ms执行一次</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(g_u8MainEventCount==<span class="number">2</span>)</span><br><span class="line">    {</span><br><span class="line">        AngleControl();                 <span class="comment">//角度环控制函数，每5ms执行一次</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(g_u8MainEventCount==<span class="number">3</span>)</span><br><span class="line">    {</span><br><span class="line">        g_u8SpeedControlCount++;</span><br><span class="line">        <span class="keyword">if</span>(g_u8SpeedControlCount &gt;= <span class="number">5</span>)<span class="comment">//25ms</span></span><br><span class="line">        {        </span><br><span class="line">              SpeedControl();          <span class="comment">//车模速度控制函数，每25ms调用一次</span></span><br><span class="line">              g_u8SpeedControlCount=<span class="number">0</span>;</span><br><span class="line">                g_u8SpeedControlPeriod=<span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(g_u8MainEventCount==<span class="number">4</span>)</span><br><span class="line">    {</span><br><span class="line">        MotorManage();            <span class="comment">//电机使能/失能控制函数，每5ms执行一次</span></span><br><span class="line">        MotorOutput();             <span class="comment">//电机输出函数，每5ms执行一次</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



















<h1 id="4-软件开发"><a href="#4-软件开发" class="headerlink" title="4. 软件开发"></a>4. 软件开发</h1><p>  我负责的是两轮自平衡小车的软件部分（下位机）的编写与验证。</p>
<p>  <strong>主要编程软件：</strong></p>
<p>MDK-ARM；STM32CubeMx；stlink烧入</p>
<img lazyload="" src="/images/loading.svg" data-src="/2023/11/23/Vehicle-Project/image-20240103235306412.png" class="" title="image-20240103235306412">





<h2 id="4-1-STM32CubeMx生成工程"><a href="#4-1-STM32CubeMx生成工程" class="headerlink" title="4.1 STM32CubeMx生成工程"></a>4.1 STM32CubeMx生成工程</h2><p>  首先，先选择对应的主控芯片的型号：stm32f103c8tc</p>
<img lazyload="" src="/images/loading.svg" data-src="/2023/11/23/Vehicle-Project/image-20231229163953002.png" class="" title="image-20231229163953002">

<p>  接着，配置好工程的基本设置</p>
<img lazyload="" src="/images/loading.svg" data-src="/2023/11/23/Vehicle-Project/image-20231229164303421.png" class="" title="image-20231229164303421"> 









<h2 id="4-2Usart与Printf函数重定向"><a href="#4-2Usart与Printf函数重定向" class="headerlink" title="4.2Usart与Printf函数重定向"></a>4.2Usart与Printf函数重定向</h2><img lazyload="" src="/images/loading.svg" data-src="/2023/11/23/Vehicle-Project/image-20240102175836402.png" class="" title="image-20240102175836402">





<p>MiaowLabs-STM32F1-Tiny 核心板板载 CH340 USB to TTL 芯片，该芯片连接 STM32F103C8T6 芯片的 Usart1 引脚 PA9/PA10。</p>

            </div>

            
                <div class="post-copyright-info">
                    <div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> MCU-Vehicle-Project</li>
        <li><strong>Author:</strong> jrl</li>
        <li><strong>Created at:</strong> 2023-11-23 23:32:52</li>
        
            <li>
                <strong>Updated at:</strong> 2024-01-04 19:03:44
            </li>
        
        <li>
            <strong>Link:</strong> https://jrl777.github.io/2023/11/23/Vehicle-Project/
        </li>
        <li>
            <strong>License:</strong> This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a>.
        </li>
    </ul>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/MCU/">#MCU</a>&nbsp;
                        </li>
                    
                </ul>
            

            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                            rel="prev"
                            href="/2023/11/23/Fi1nd_th3_x---WP%EF%BC%9A/"
                            >
                                <span class="left arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-left"></i>
                                </span>
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">Geek2023</span>
                                    <span class="post-nav-item">Prev posts</span>
                                </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                            rel="next"
                            href="/2023/10/06/MCU-Study-Stm32/"
                            >
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">MCU-Study-Stm32</span>
                                    <span class="post-nav-item">Next posts</span>
                                </span>
                                <span class="right arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-right"></i>
                                </span>
                            </a>
                        </div>
                    
                </div>
            


            
                <div class="comment-container">
                    <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fa-solid fa-comments"></i>&nbsp;Comments
    </div>
    

        
            
 
    <div id="waline"></div>
    <script type="module"  data-pjax>
        import { init } from 'https://evan.beee.top/js/waline.mjs';

        function loadWaline() {
            init({
                el: '#waline',
                serverURL: 'https://comment-mtuzebtyq-jrl777.vercel.app/',
                lang: 'zh-CN',
                dark: 'body[class~="dark-mode"]',
                requiredMeta: ['nick','mail'], // cannot customize by theme config, change it yourself
            });
        }

        if ('true') {
            const loadWalineTimeout = setTimeout(() => {
                loadWaline();
                clearTimeout(loadWalineTimeout);
            }, 1000);
        } else {
            window.addEventListener('DOMContentLoaded', loadWaline);
        }
        
    </script>



        
    
</div>

                </div>
            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">On this page</div>
        <div class="page-title">MCU-Vehicle-Project</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Vehicle-Project"><span class="nav-text">Vehicle Project</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="nav-text">1.原理分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-%E5%B9%B3%E8%A1%A1%E5%8E%9F%E7%90%86"><span class="nav-text">1.1 平衡原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-%E5%8A%A8%E5%8A%9B%E5%AD%A6%E5%88%86%E6%9E%90"><span class="nav-text">1.2 动力学分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-%E6%95%B0%E5%AD%A6%E6%A8%A1%E5%9E%8B"><span class="nav-text">1.3 数学模型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-Simulink%E4%BB%BF%E7%9C%9F"><span class="nav-text">1.4 Simulink仿真</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-5-%E5%B0%8F%E8%BD%A6%E7%9A%84%E9%80%9F%E5%BA%A6%E6%8E%A7%E5%88%B6%E5%8E%9F%E7%90%86%E4%B8%8E%E4%B8%B2%E7%BA%A7PID"><span class="nav-text">1.5 小车的速度控制原理与串级PID</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E7%94%B5%E8%B7%AF%E5%BC%80%E5%8F%91"><span class="nav-text">2. 电路开发</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-%E7%B3%BB%E7%BB%9F%E6%A1%86%E6%9E%B6%E4%B8%80%E8%A7%88"><span class="nav-text">2.1 系统框架一览</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E7%A8%8B%E5%BA%8F%E6%A1%86%E6%9E%B6"><span class="nav-text">3.程序框架</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-BspInit-%E5%87%BD%E6%95%B0"><span class="nav-text">3.1 BspInit()函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-PIDInit-%E5%87%BD%E6%95%B0"><span class="nav-text">3.2 PIDInit 函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-CarUpstandInit%E5%87%BD%E6%95%B0"><span class="nav-text">3.3 CarUpstandInit函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-SysTick-Init%E5%87%BD%E6%95%B0"><span class="nav-text">3.4 SysTick_Init函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-5-%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0"><span class="nav-text">3.5 其他函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91"><span class="nav-text">4. 软件开发</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-STM32CubeMx%E7%94%9F%E6%88%90%E5%B7%A5%E7%A8%8B"><span class="nav-text">4.1 STM32CubeMx生成工程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2Usart%E4%B8%8EPrintf%E5%87%BD%E6%95%B0%E9%87%8D%E5%AE%9A%E5%90%91"><span class="nav-text">4.2Usart与Printf函数重定向</span></a></li></ol></li></ol>

    </div>
</div>
            </div>
        
    </div>
</div>


                

            </div>
            
            

        </div>

        <div class="main-content-footer">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info">
            &copy;
            
              <span>2022</span>
              -
            
            2024&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">jrl</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv" class="busuanzi_container_site_uv">
                        VISITOR COUNT&nbsp;<span id="busuanzi_value_site_uv" class="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="busuanzi_container_site_pv">
                        TOTAL PAGE VIEWS&nbsp;<span id="busuanzi_value_site_pv" class="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            <span class="powered-by-container">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" href="https://hexo.io">Hexo</a></span>
                <br>
            <span class="theme-version-container">THEME&nbsp;<a class="theme-version" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.2.2</a>
        </div>
        
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
        
            <script async data-pjax>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fa-regular fa-comments"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-expand-width flex-center">
            <i class="fa-regular fa-expand"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fa-solid fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fa-solid fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    


</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/layouts/navbarShrink.js"></script>

<script src="/js/tools/scrollTopBottom.js"></script>

<script src="/js/tools/lightDarkSwitch.js"></script>



    
<script src="/js/tools/localSearch.js"></script>




    
<script src="/js/tools/codeBlock.js"></script>




    
<script src="/js/layouts/lazyload.js"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js"></script>







<div class="post-scripts pjax">
    
        
<script src="/js/tools/tocToggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/layouts/toc.js"></script>

<script src="/js/plugins/tabs.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax',
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            Global.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            Global.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            Global.refresh();
        });
    });
</script>




</body>
</html>
